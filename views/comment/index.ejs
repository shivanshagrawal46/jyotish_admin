<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comments | Sanskrit Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
  <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/sidebar.css" rel="stylesheet">
  <style>
    :root {
      --primary: #2D3250;
      --secondary: #424769;
      --accent: #676F9D;
      --light: #F9F9F9;
      --dark: #1A1B26;
    }
    .main-content { margin-left: 280px; padding: 2rem; }
    .topbar { background: #fff; padding: 1rem 2rem; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06); margin-bottom: 2rem; display:flex; align-items:center; justify-content:space-between; }
    .page-title { font-family:'Playfair Display', serif; font-size:1.5rem; color:#1A1B26; margin:0; }
    .content-card { background:#fff; border-radius:16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06); padding:2rem; }
    .table-responsive { max-height: 70vh; overflow-y: auto; }
    .comment-text { max-width: 300px; word-wrap: break-word; }
    .btn-sm { padding: 0.25rem 0.75rem; font-size: 0.875rem; }
  </style>
</head>
<body>
  <nav class="sidebar">
    <%- include('../partials/sidebar', { activePage: 'comments', activeCategory: null, koshCategories: [], mcqCategories: [] }) %>
  </nav>
  <main class="main-content">
    <div class="topbar">
      <h1 class="page-title">Comments Management</h1>
      <div class="user-menu">
        <div class="user-avatar"><%= username ? username.charAt(0).toUpperCase() : 'A' %></div>
      </div>
    </div>
    <div class="content-card">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="mb-0">All Comments</h5>
        <div class="text-muted">Total: <%= total %></div>
      </div>


      <% if (comments && comments.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>User ID</th>
                <th>Name</th>
                <th>Mobile</th>
                <th>Comment</th>
                <th>Created At</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% comments.forEach(function(comment) { %>
                <tr>
                  <td><%= comment.id %></td>
                  <td><%= comment.userId %></td>
                  <td><%= comment.name %></td>
                  <td><%= comment.mobile %></td>
                  <td class="comment-text"><%= comment.comment %></td>
                  <td><%= new Date(comment.createdAt).toLocaleString() %></td>
                  <td>
                    <button class="btn btn-sm btn-danger" onclick="deleteComment('<%= comment._id %>')">Delete</button>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <% if (totalPages > 1) { %>
          <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              <% for(let i = 1; i <= totalPages; i++) { %>
                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                  <a class="page-link" href="/comments?page=<%= i %>"><%= i %></a>
                </li>
              <% } %>
            </ul>
          </nav>
        <% } %>
      <% } else { %>
        <div class="alert alert-info text-center">
          No comments found.
        </div>
      <% } %>
    </div>
  </main>
  <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script>
    function deleteComment(commentId) {
      if (!confirm('Are you sure you want to delete this comment? This action cannot be undone.')) {
        return;
      }

      fetch(`/comments/${commentId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Error: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error deleting comment');
      });
    }
  </script>
</body>
</html>

